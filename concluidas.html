<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Histórico de Concluídas - Firebase</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; }
body, html { margin:0; padding:0; font-family: 'Roboto', sans-serif; background: linear-gradient(135deg, #f0f2f5, #c8e6ff); min-height:100vh; }
h1,h2 { margin:0 0 10px 0; color:#222; font-weight:700; }
.wrap { display:flex; flex-direction: column; align-items:center; padding:30px; gap:25px; }
.card { background:#fff; border-radius:20px; box-shadow:0 8px 20px rgba(0,0,0,0.1); padding:25px; width:100%; max-width:600px; transition: transform 0.2s, box-shadow 0.2s; }
.card:hover { transform: translateY(-6px); box-shadow:0 12px 25px rgba(0,0,0,0.15); }
.list { margin-top:10px; max-height:500px; overflow-y:auto; }
.item { background:#f0f4ff; padding:12px; margin-bottom:12px; border-radius:10px; display:flex; flex-direction:column; gap:4px; }
.numeroPeca { font-weight:700; color:#222; font-size:1.05em; }
.solicitante { color:#555; font-size:0.9em; }
.descricao { font-size:0.92em; color:#333; white-space:pre-wrap; }
.conclusao { font-size:0.88em; color:#555; }
.actions { display:flex; gap:10px; margin-top:8px; }
.actions button { flex:1; padding:8px; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition: transform 0.1s; }
.actions button.excluir { background:#dc3545; color:#fff; }
.actions button.excluir:hover { transform: translateY(-1px); opacity:0.95; }
.actions a { flex:1; padding:8px; text-align:center; background:#007BFF; color:#fff; border-radius:8px; text-decoration:none; font-weight:600; }
.actions a:hover { background:#0056b3; }
@media(max-width:700px){ .wrap{ padding:20px; } .card{ width:100%; } }
</style>
</head>
<body>

<div class="wrap">
  <div class="card">
    <h1>Histórico de Concluídas</h1>
    <div class="list" id="listaConcluidas"></div>
    <div class="actions">
      <a href="index.html">Voltar</a>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, getDocs, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAgnptSu09DJlZYVHKSCwPhZLEVwFSQduw",
  authDomain: "requisitonotas.firebaseapp.com",
  projectId: "requisitonotas",
  storageBucket: "requisitonotas.firebasestorage.app",
  messagingSenderId: "64291138957",
  appId: "1:64291138957:web:3494c68e85273f4ba361c4",
  measurementId: "G-G9567BLMH7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const listaConcluidas = document.getElementById("listaConcluidas");

async function carregarConcluidas(){
  listaConcluidas.innerHTML = "";

  const q = query(collection(db, "requisicoes"), orderBy("conclusao", "desc"));
  const snapshot = await getDocs(q);

  snapshot.forEach(docSnap => {
    const r = docSnap.data();
    const id = docSnap.id;
    if(r.concluido){
      const dataFormatada = new Date(r.conclusao).toLocaleDateString("pt-BR");
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <div class="numeroPeca">${r.numero} - ${r.peca}</div>
        <div class="solicitante">${r.solicitante} | ${r.criado_em}</div>
        <div class="descricao">${r.descricao || ""}</div>
        <div class="conclusao">Concluído em: ${dataFormatada}</div>
        <div class="actions">
          <button class="excluir" onclick='excluir("${id}")'>Excluir</button>
        </div>
      `;
      listaConcluidas.appendChild(div);
    }
  });
}

window.excluir = async function(id){
  await deleteDoc(doc(db, "requisicoes", id));
  carregarConcluidas();
}

carregarConcluidas();
setInterval(carregarConcluidas, 60000);
</script>

</body>
</html>
